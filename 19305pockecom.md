---
marp: true
footer: ポケコンで無線通信！/ 細かすぎて伝わらない昭和のエンジニア昔語り講演会！ #ALGYAN / ぺんた @plageoj
_footer: ""
paginate: true
_paginate: false
---

<style>
*{
font-family: "M+ 1p";
line-height: 1.4em;
}
p,li{
font-size: 2.8rem;
}
h1,h2{
font-size: 2.3em!important;
}
code,code>*{
font-size: 32px!important;
}
img{
vertical-align: middle;
}
</style>

# ポケコンで無線通信！

---
<!--
	page_number: true
-->

### すがはら　まさゆき
## 菅原　政行

1998　広島県生まれ

2009　__PC-9801__ で __N-BASIC__ をはじめる

2011　Windows 95 で **Visual Basic 4** をはじめる

2012　__PC-G850VS__ を入手

2017　広島大学工学部入学

---

# 世代としてどのあたりか

同級生は、

+ フロッピーディスクは 3.5 in なら分かる人がいる
+ 「ラップトップ」は通じない。「ノート」
+ 音楽用カセットテープを知らない人がまれにいる
+ 1 KB = 1024 B が主流
+ マイコン = マイ コンピュータ

---

## 本日の概要

1. ポケコンについておさらい
1. 愛を語る
1. 最近のマイコンと接続する
1. HTTP で通信する
1. IoYT におけるポケコンの可能性

---

# &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ポケコン

$$$$

$$$$

$$$$

$$$$

$$$$

$$$$

$$$$

$$$$

![bg 98%](http://www.jibunde.com/pokecom/gazo/max/PC-G850VS_front.jpg)

---

# PC-G850VS

+ SHARP製、2009年発表
+ CPU Z80互換 CMOS @ 8MHz
	+ 世界最後の 8bit マイコンという噂も
+ RAM 32KB SIMM
+ 144 × 48 グラフィックLCD

---

# PC-G850VS

+ 定格消費電力 0.2W
+ 重量 270g (電池込)
+ 単4電池 4本、公称使用時間 70時間
+ QWERTY配列キーボード + テンキー
+ ハードカバー標準装備

**このページだけ見れば、スマホよりも強力！？**

---

生産終了したので
# Amazon で探してみた

---

# 残り2点 ご注文はお早めに

取説がないとマトモに使えません。

![100%](https://qiita-image-store.s3.amazonaws.com/0/116845/707255ce-4757-fa3f-38dc-859a8fb4c77c.png)

---

# 使える言語

+ 構造化 BASIC
+ C 言語
	+ `#include` が不要など、くせがある
+ PICアセンブラ
	+ ライタがあれば PIC に書き込める
+ Z80アセンブラ
+ CASL Ⅰ

---

# 愛を語る

---

# しれっと学校に持ち込める

先生: 「これなんですか？」

わたし: 「**電卓です**」

若い情報の先生もバレませんでした
(あれ？)

---

# 打ちやすいキーボード

**FAQ: 「__そんなに小さいキーで打てるの？__」**

ファミコンのコントローラーと同じ構造。
慣れれば普通に打てます

---

# 爆速起動

電源をいれると、すぐインタプリタが！

この手軽さは、**どんなワンボードマイコンにも真似できません**

---

# 電池が長持ち

公称は 70H ですが、
70H も連続使用しないので

使わなければ **年単位で電池が持ちます**

---

# 残念な変数名

+ BASIC の変数名は2文字まで
+ 1文字変数では文字列と数値の使い分けができない

---

# 残念なエディタ

+ C言語でも行番号が必須
+ もちろんアセンブルでも行番号が必須

---

# ポケコンは青春とともに
手書きでプログラムをバックアップしたノート どこにあるかなあ……

---

# 最近のマイコンと接続する

あやしげな設定メニューが。

![image.png](https://qiita-image-store.s3.amazonaws.com/0/116845/85c48ec3-8c7e-3221-2369-28de0517a352.png)

#### ※ 以降、スクリーンショットはエミュレータのものです

---

# 11ピンIO


プリンタやシリアル変換器が接続できるが、

純正品は入手困難。

![height:300px](http://www.jibunde.com/pokecom/gazo/max/PC-G850VS_left.jpg)

---

# もしやArduinoと通信可能では？
### 両方とも5V動作だし。

---

# ルール

+ 裏蓋を開ける改造はしない
	+ 買い替えは無理です……

+ 機械語は使用しない
	+ 取説にリファレンスがついていないので

	  ニモニックが何もわかりません

---

# できそう

ピン配置が**取説に載っていない**

ですが、いくつか資料はあります

#### ← 画面側　　　　　　　　　　 　 　 キーボード側 →
|1 | 2| 3| 4| 5| 6|7 |8 |9 |10|11|
|:-|:-|:-|:-|:-|:-|:-|:-|:-|:-|:-|
|NC|5V|GND|RS|DR|RX|TX|CD|CS|ER|CI|

### 先人に感謝。

---

# できました

|PC-G850| |Arduino|
|:-----:|:-|:----:|
| 3 GND | | GND   |
| 6 RX  |←| TX    |
| 7 TX  |→| RX    |

Arduino 側のピンはスケッチで指定します。

0番、1番ピンそのままでは使えません、というのも

---

# シリアルで通信する

ポケコンの信号は RS-232C 準拠です

![image.png](https://qiita-image-store.s3.amazonaws.com/0/116845/a96c1f4c-718b-bd03-db18-a5c07631674a.png)

出典: wrabetz.de/resources/Sharp_PC-G850VS_Interface.pdf

---

# SoftwareSerial を使う

IC がいらないのがありがたい

```cpp
#include <SoftwareSerial.h>

SoftwareSerial g850(RXPIN, TXPIN, true);

void setup(){
    g850.begin(9600);
}
```

---

# ポケコン側

```BASIC
10 OPEN "COM1:"
20 INPUT OU$:PRINT #1,OU$:GOTO 20
```

`OPEN "COM:"` とすると半二重通信になり、
ArduinoでEOFを送信するまでポケコン側から送信できなくなります（たぶん）

---

# 文法について

PC-G850VS では行末のダブルクオーテーションを省略できるのですが、
**シンタックスハイライトがきかなくなる**ので泣く泣く書きました

---

# フロー制御

自前で実装してやる必要があります。

```cpp
void flowControl() {
  if (g850.read() == 19) { // XOff
    while (g850.read() != 17) // XOn
      delay(20);
  }
  delay(10);
}
```

---

# ポケコンとナウいマイコンを
# つなげると何ができるか？

---

# なんでもできます

---

# HTTP 通信もできます

---

期末テストリセットでプログラムを消してしまったので

エミュレータによる動作デモをご覧ください

---

![100%](https://qiita-image-store.s3.amazonaws.com/0/116845/65f41fc2-efbc-8231-b97a-71c8c8d052ba.png)

---

# シリアルでマイコンにプログラムを転送すれば、授業中のファイル共有が可能になる

（ポケコンの標準機能だけで！）

---

![image.png](https://qiita-image-store.s3.amazonaws.com/0/116845/b54953df-282a-37c8-654f-dd164a20c777.png)

---

![image.png](https://qiita-image-store.s3.amazonaws.com/0/116845/62788d27-1874-9995-3b51-beca18f387f2.png)


---

# Twitter for PC-G850VS

ポケコン + ESP32 で、

+ 特定ユーザのツイート取得
+ 検索
+ ツイート

できます。動作画像は **[#ポケコンでモテる大学生](https://twitter.com/search?q=%23ポケコンでモテる大学生)** で検索！

---

![image.png](https://qiita-image-store.s3.amazonaws.com/0/116845/e20b0d79-04af-a5d1-5ccb-0cb1d949d340.png)

---

![](https://techmode.co.jp/images/20190305_p3.jpg)

---

# IoYT におけるポケコンの可能性

---

# ハードウェアとしての完成度が高い

UART ができるマイコンがあれば、簡単に

フルキーボードと画面表示を追加できます

---

# スクラップ & ビルドがしやすい

母艦なしにプログラムを書き換えられ

即時に実行・テストできます

---

# SaaS：仕様としての画面

メニュー画面を作るだけで、やりたいことが定まります

画面一枚は 144 文字出力するだけです

---

# たとえばこんな感じ

![](https://pbs.twimg.com/media/D0QLYdjUUAMraiU?format=png&name=900x900)

Git ができそうな気がしてきませんか

---

# 計算能力とRAMをクラウドで補えば
# ポケコンは IoYT プロジェクトで
# 絶大な威力を発揮します

---

# ポケコン×クラウドはニッチなので
# 何をやっても世界初（たぶん）

---

# ディスプレイとして使ってるだけ？

そのとおりです。

メインフレームのアプローチそのものです。

---

# 押し入れに眠っているポケコンを、
# あなたの IoYT プロジェクトに
# 組み込んでみませんか？

---

# ありがとうございました

@plageoj
